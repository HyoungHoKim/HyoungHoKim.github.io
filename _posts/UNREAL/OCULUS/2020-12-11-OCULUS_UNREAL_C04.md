---
layout: post
title:  "Oculus와 언리얼 엔진을 사용한 VR개발_C04"
date:   2020-11-29 21:35:19 +0900
categories: [UNREAL, UNREAL/OCULUS]
---

### 시작하며
- 언리얼 엔진 공식 홈페이지 온라인 러닝 프로젝트 중 \<Oculus와 언리얼 엔진을 사용한 VR개발\>에 대한 요약 및 정리입니다.
- 블루프린트로 진행되며, 프로젝트를 하는데 필요한 에셋은 모두 제공됩니다. 코스 설명대로 따라하면 다운받을 수 있습니다.
- 추후 C++로 바꿔볼 예정입니다.
- 관련 링크 : https://www.unrealengine.com/en-US/onlinelearning-courses/vr-development-with-oculus-and-unreal-engine

### VR 고려사항
- 기존 3D 렌더링은 이미지 평면이 평평한 2D 사각형이라고 상정합니다. VR 헤드셋을 사용할 이미지를 만들려면 이 이미지를 대규모 필드 오브 뷰에 맞춰서 왜곡시켜야 합니다. 그러면 화면 바깥 영역에서 계산의 낭비가 생깁니다.
- Fixed Foveated Rendering
  - Oculus Quset는 고정 포비티드 렌더링, 일명 FFR을 지원하여 그 영역에서의 픽셀 셰이더 계산과 메모리 광대역을 아낄 수 있게 해줍니다.
  - 블루프린트로 설정이 가능합니다.
    - Set Fixed Foveated Rendering Level 노드
    - FFR 수준이 높을 수록 퍼포먼스가 절약되지만 대신 지엽적 해상도가 희생됩니다. 유일한 예외는 FFR High Top인데 화면 아래가 더 디테일해지고 포비션이 더해집니다.
  - 고정 포비티드 렌더링이 활성화되면 이미지 중앙에서 멀리 떨어진 영역의 더 낮은 해상도 렌더링에서는 해상도가 낮기 때문에 디더링이 더 부각되는 걸 볼 수 있습니다. 일반적인 고주파 기본 패턴은 퀄리티 레벨 간 블렌딩이 없기 때문에 아예 없어질 수도 있습니다. 디더링을 아예 사용하지 않는다면 더 안 좋아 보일 수도 있습니다.
  - 그래서 디더링은 웬만하면 FFR에서는 피하고 MSAA와 호환하는 겁니다. 일반 픽셀별 조정이나 디더링을 피하는 한 다수의 셰이드를 얻을 수 있습니다.
  - MultiView Render Features
    - Quset에서 또 한가지 굉장한 최적화는 바로 멀티 뷰 렌더 기능입니다. 강좌 1에서는 인스턴스 스테레오 렌더링이라는 렌더러 기능을 간단히 다뤘습니다. 멀티뷰는 이걸 더욱 개선할 수 있는 최적화입니다. 강좌 1에서 언급했던 것처럼 모바일 HDR이 비활성화 되어 있어서 모바일 MultiView가 작동하는지 확인해야 합니다.
    - Setting - Rendering - VR - Mobile Multi-View and Mobile Multi-View Direct 활성화
  - 파티클 역시 VR 렌더링에서 고려해야할 사항입니다. GPU가 서로 겹치는 투명 스프라이트로 인해 지나치게 많은 계산을 해야할 때 오버드로 문제가 나타날 수 있습니다. 연기와 가은 파티클 시스템은 VR 퍼포먼스를 빠르게 저해할 수 있습니다. 가능하다면 머티리얼 이펙트를 더 사용하고 레이어드 파티클 이펙트를 줄여야합니다.
  - VR에서 발생하는 파티클 문제는 파티클의 근본적인 문제입니다. 기본 스트라이트 시야에 평평하도록 계속해서 정렬되는데 그 이유는 우리가 씬을 스테레오로 보기 때문입니다. 그래서 사용자는 파티클 스프라이트가 평평하다고 느끼기 쉽습니다. 대형 스프라이트를 카메라 근처나 카메라에 교차하게 렌더링하지 마세요. 웬만하면 더 작은 파티클을 사용하는게 좋은데 이게 눈에서 3D로 처리하기 쉽기 때문입니다.
  - 볼륨에 파티클을 스폰하는 3D 파티클 이미터도 특히 잘 읽히는 편입니다. 파티클 간에 서로 뎁스가 있기 때문입니다.
  
